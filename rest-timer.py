#!/bin/python3

"""This is a simple and small but useful GUI application that notifies you
to give your eyes a rest after the time you specify.

https://github.com/AmirAli104/rest-timer

License: MIT License
"""

import tkinter as tk
from tkinter import messagebox
from tkinter import ttk
import re

timer_btn_color = '#00bc00'
after_id = None
APP_TITLE = 'Rest Timer'

ICON_BYTES = b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x00-\x00\x00\x00-\x08\x06\x00\x00\x00:\x1a\xe2\x9a\x00\x00\x081IDATx\x9c\xed\x99m\x8cT\xd5\x19\xc7\xff\xcf\xb9\xe7\xdc\x19v\xbaP@Xfg\xd7\x05APHS(\xa1\xb4\xb6bijC\x976 \x86\xad\x95\x02\xee\xce\xccbl\n\x1fH\xd4MJ\x90\xf4\xc5V\xaa\t\x8dQw\xe7\xce\x0cB\xaa\xcdV\x05\x05\xcc6\xad\xadFT"h\xd3\xd2\xba\x88[qwg\x07D@\xf6e\xd8\x9d\xb9\xf7\x9e\xa7\x1ff\x89k\x9c\x97]wh\xbf\xf0$\x93\x93;\xe7\xff\x9c\xe7w\xcf=\xe7\xdcs\x9e\x0b\\\xb5\xab\x96\xd7\xa8\x94\x8d\xc5\xe35^\xe6\xcc\xcdZ\xd3T"N\x03\x80\x10\xe4!\xe2\xb4R\xea\xe5u\xeb\xba>.E\x9c\x92A\xb7\xb6\xae5\xfa\xfb_\x8b\x9b&\xd63\x03\xcc\xc3\x01\x08\x10\x02H\xa7\xf9\r\xd3\xf4\xadX\xbf\xbe\xa3o\xbc\xb1D\tx\x01\x00\xa9\xd4\x9b\xd3\x98y\x8d\xe30l\x9b\xe18\xd9\x9fm32\x19\x86a\xd0\xd7\xd3\xe9\x81\xb9\xa5\x88U2h\x9f\xcf\xed\x15\x82\xfe\xe5\xf1\x10\xa4\xfc\xe4\x01\x1a\x06\xe0\xf1\x10\\\x97\x13\xaek\xf6\x94"VI\xc7t$2\x7f\x8ai\\\\mk^j\x18h\x14\x82\xe0:\xf4\x82\x14\xbc\xcf\x85z\xb9\xbe\xbe\xf3\x83R\xc4)\t\xf4\xde\xbd\x81*\xdb\xe6o\x00\xb4\x84\x19\xb3\x01}=\x11\x16\x10\x01ZS\'\x11\xbd\r\xf0\xbbDt\xcc\xe3\x8a7\xee\x0cu\'\xffo\xd0\xbbw\x07\x963\xebM\xcc\xb8UJ\x9ab\x18\x9f\xd4\xb9n\xb6\x14\x02 \x01\x80\xb3\xff96\x9f\x07\xe1\xcf\x80\x8844\xf4\xfc\xf5\x7f\x06\x1d\x89\xd4\xdc(\xa5\xfd\x0b\x80W+E\x02\x00\xb4\x062\x19N\x11D7H\xf7\x00\xb8\x08@\x034\t@%\xc05JQ\xb9\x18\x9eE\x99\x0c3\x11\x0e8\x8e\xd8\x16\x0e\xf7\xfc\xf3\x8aB\xc7"\x95\x1b\x85\xc4o\xa5\xc25\xcc\x80m\xe3\x121\xda\x98\xc4\xb3\xcc\xe2\x88\xdf?\xbf\xa7\xb6\xb6-=\xd2\xa7\xb9y\xb12\xcdD\x80\xd9\\\n8\xab\x01\xd4\x9a&M\x04\x00\xc7\xe1\x8b\x8eCM\xa1P\xf2\x89+\x02mYU\xdb\xa5\xd4\x0f\x08\x01\xb8.\x03\xa0\xa7\xc9\xf1\xfc\xfa\xae\xf0\xa9\xcf\xf4T,V\xf9\x083\xcf./?\xbd\xa6\xae\x0e\xee\xc8\xbax\xbc\xe6\x06\xc0\xde\xca\xcc\xf5J\x91\xa15\xe0\xbax\xa8\xbe>y?\x11\xb8\x18\x87\x1c-p4Z\xb9M)\xfd\x00\xb2\xe3\xf5\x9c\xd6\xc6\xe6`0\xf1t>=\xb3X\n\xd8s\x87\x86*\xbc\xc0\x87\xa9\x91u\xf5\xf5\x9d\'\x00\x84#\x91\xca\x17\x88\xf81)\xa9J\x08\xdc\x1b\x8dV\x02H\xdeW\x8ceT\xeb\xb4eU\xde!\x04v\x00\x80\xe3\xa0\xcbu\xf5\xf7\n\x01\x03\x00\x11kf\x82\xd7\xabt>M8\x9c<\xe08\xe6wm\x9bN\x00\x80R\xb8\xd7\xb2\xfc\xe1qC\xc7\xe3\x153\x85\xe0]R\x82\x1c\x87\xcf\x0b\xc1kB\xa13\xc7\x8a\xf91\xd3#\x00\xb6\xad]\x9b\x18*\xa4\x0b\x87;\xdb\xc9\x96\xb7\xd96\'\x84\x00\x84\xc0\xce\x96\x96\xea\x05\x85|\x8a\x8ei\xcb\xf2?\xe9\xf5\xd2\x06\xdb\x06;\x8e\xf8q8\x9cx\n\xc3\x93\xcb\xeb\xfd\xf8\xcb\xe7\xceM\xff\xf7\xd6\xadG\x06\x8b\xb5S\xccb\x91@-I\xfd\xbcR$\x87\x86\xf8`w\xf7\xe9U;v \xe7S*\xd8\xd3\xf1x\xe5B!p\x07\x00\xb8.\xef\xbb\x0c\x0c\x00J\x9d\xf9\x81\x94\xe9\xa3\x93\'w=\x17\x8d\xce\x996^\xe8\x86p\xcf\x8b\xda\xc1\x1e\x00\x90\x92j\xab\xabkn\xc9\xa7-\x08\xcd.\x85<\x1e23\x19\xce0\xab_\x8d\xacs]\xd9\x9eN\xeb\xd3ee\xb4B\x88K\x87\xa2\xd1\xe9\xd7\x8d\x17\\\xc1x0\x93\xe1~\xa5 \x80\xcc\xddc\x86\xb6\xacy\xe5L\xfc}d_\x1c\x87\xc3\xe1\xae\xb7F\xd6\x87\xc3\x9d\xed\xe4\xf8\xd6\x0c\x0e\xe2\xac\xd7\x8b%B\x18m\xb1\x98\xff+\xe3\x81\xde\x10Nt0\xe3\x10\xb2[\xda\xef\xc4\xe353\xc6\x04-D\xff\x97\x88\xf8\xda\xe1}\xf1\xfe\\\x9a\xfa\xc6\x8e#Z{n\x1f\x1a\xe2\x8f<\x1e\xba\x9e\x88^\x8c\xc5\xaao\x1d\x0f8\xb3x\xc6q\x00\xa5h\x8a\xeb\xba_\x1b\x134\xb3Xd\x9aD\x99\x0ck!\x8c#\xf9t\xc1\xe0\xfb\x87m\x1b\xb7\xa7\xd3t\xd64QA\xe4>gY\xfeu\x9f\x1f[\x1d\xb3m\x1e0\x0c\x80H\x7fuL\xd0\xc4z\x0e\x11\xc0\x8c\x8bD\x13\xbb\x0b\x85il<\xfd\xaamOX\x95IsB)|\x01\xc0\xeeh\xd4\xffZ<\xee\x7f\xde\xb2\x02\xcb\xc7\x82\x9cJ\xc93\x00\'\x89\x00\x80\xe7\xe4\xd2\xe4}#2\xe9i\x94\xdd\x0b\xf5^\xb8\xd0\xd7kY\xf3*=\x1eZ\xa4mb\x87\xed\xa3\xc1`\xc7G\x9f\x06\xef8\x12\x8bM\xaf\xcddd\xab\x94t\x03\x11n2\x0c@k\xbdlO\xa4j\xc9\x86p\xa2#W\x1c\xcb\x9aW\xae\x04nR\x8a\xa4;\xe8\xfcc}cG"\x1a\x9dq\x1e\x00\x9815\x97O\x81\xe1A\x9el\xc9\xf6\xd6\xad\x89A\xa2\xfe\xa6\xb2\xb2\x81\x83\xbe\x89\xfd\x87\x88\x07\xb7\xe4\xf2ih8{\x9cY=$\r\xc0q\x18\xe94\xc3\xe3\xa1/\xdaB\xe4\x1c\x9b\x00 D\xef\x9de\xe5\xa96O\xd9\xc0\xc1\xb4H\xfdr8v&[Kf.\x9fB{\x8fK\xc3\xa5\xb7\xb9\xd9_FD\xbfK\xa5\xf8\xb8\xd6\x1a\xb6+_\xca\x7f\xb3\xfa\xb8\xed\xb0\x96\x92\x04\x11\x90\xc9\xc0!\xc2;\xf9\xf4Z\xab\x03\xa9\x94\xe3\x1a\x860\x84k\xbc\x8e\xec\xca1![r:\x97O^hA\xe2Cf\x06\x91\x98TFS\xa7\xaco8\xfe\x1e\x80\xf7\n\xdc$\x00 \x14\xea>fY\x95?!\xc2f\xadY3\x1b\x0f\x07\x83]o\x17\xd0\'\x01X\x97\xaf[[\xab&\xf4\xf5\xb9\xc3\xc3\x82\xcf\xe5d\xcb\xd7\x18C\xbf\xab5@\xc4\x13mynV1\xd8O\x83$\x9f\xe8\xed-[\xd4\xd7\xe7[\x1c\x0c&\xe2c\xf1\xed\xef\x17~\x003\xb2i\x08#\xe7<\xc8\xdf\xd3\x82\xde\xb2mvL\x93\xe4\xd0\x10\xdd\x0c\xe0\xd5\xb1\x04\xdf\xb2\xa5#\xe7\xa3-fB\xb8\x8b\r\x83|\x8e\x03\x08!\x8e\xe6\xd4\xe4s\xae\xa8(k\xd7\x9aN\x12\x01DzUk\xebZ#\x9f\xb6\x94\xe6\xba|\x9b\x91\x9d\xc8\x17l\xdb\xf7f.M^\xe8\xda\xda\x8e4@\xcf2\x03B`\xf1\xc0\xc0\xeby70\xa5\xb2\xdd\xcd\xd5\xb3\x89x%\xb2\xcb\xdd_6m:q:\x97\xae\xe0\x86Ik#\x9e\xc9p\xafRd0\xeb\x9f]\xe9\xdev\x0c\xb7\xc9\xe3\xa1\x89\xb6\xcd\x1a\x10y\xcf\x8c\x05\xa1\x1b\x1b\xbbNiM\xcd\x00\xa0\x14-\xef\xeb;|\xcf\x95\x80\x05\x00\xcb\n\xac4\x0c\xde\x88\xec\xe9\xa8\xad\xbb\xbb\xe7\x95|\xda\xa2\'\x17f\xf1\x9bt\x9aO\x0e\'\x12\x1f\x8c\xc5\x02\xdf\x1e\rD\xbc\xa5r\xa1e\xcdX6\x1am4z\xed|Cp\xb3a\x90\xb4m\xeeg\x16M\xf9\x0e\x00\xa3\x82\x0e\x87\x13\x17\x98\xcd\xbbm\x9b\x87\xa4$\x1f\x11\xff!\x1e\t|\xab\x98\x9f6\xc4\xc3D\xd8\xbbk\xd7\x1cO!]KK\xf5\x02"{\x9fT\x080\x03Z\xd3}\xc5\xf2 \xa3:\xd8\x86B\x9d\x7f#-6\xbb.\xd800\rR\xef\xb7\xac\xca\xbb\x8a\xb8y\x01x\xbc\xdeT\xdey`Y\x81\x95J9mJ\xd1\\ds ;\x83\xc1\xe4\xe3\xc5xF\x9d5\xad\x0f\xf5D\xb4\xc6O\xb5f[J\x9a$%\xe2\xf1x\xe0\xf7OFjn\xcc\xa5\'F\x073>H&\';\x9f\x85\x9dY\x13\x8b\xf9\x1f\x15B\xef7\x0c\xaa\x1a\xceN\xed\xec\xeaj\xbc\x7f4,c\xce0\xc5\xad\xaa\xd50\xdcG\x95\xa2\x00\xb2\xe9\xad>"\xf1\x0c\xc0O\xf9|\xdecuu\xef\xf7^\xd6n\xdf>\xdf\xdc\xb1\xe3\x9d\x0c\x00\xec\xd9S\xe1s]\xb1\x90\x99\xea\x00\xfc\xc841\r\xd9I\xd7\xeb\xbah\x1aM\x0f\x7fnh\x00hi\xb9v\x96\x94\xce\xcf\x89\xf8\x87\xa6I2\x0b\x0fh\xad\xbb\xc0\xa2\x1d\xc4\xffa\xe6\xb3D\xd0\xcc\xe2\x1a"\x9a\x05\xe8\xf9\x00\xae\xf3x\xb2;e\xc7\x01\x98\xf1\'\xd7UM\xa1P\xe7\xdf\xc7\x12\x7f\\Y\xd3h\xb4\xfa\x9bB\xb8\xf70\xf3\n\xa5h\xf2\xc8\xac\xe9\xc8\xcf\x17\x97mx\x18\x0c\x02\xf4\x8a\x10x\xfc\xd4\xa9\xe4\xc1B\xab\xc4\x15\x81\xbel\x965\xb3FJ\xf7\x16\xad\xdde`,\x00\xc1\xcf\xac}YzJ\x93\x10g\x99\xf5I"\xe3\xb0a\x18/m\xdc\xd8\xd9>\x9ex%\xfd\x12p\xb9I\xcb\x9a[N\xd4\xebU\x8a\xc9\xeb\xf5\xa5\x81\xc5\x03uu\x7ftG\xe1|\xd5\xae\xdax\xed\xbf?>\xabn^Z\x0f\xbf\x00\x00\x00\x00IEND\xaeB`\x82'

def rest_message():
    messagebox.showinfo(title=APP_TITLE, message='You should rest')
    start()

def stop():
    global timer_btn_color
    timer_btn.config(bg = '#00bc00', text='Start Timer', command=start)
    timer_btn_color = '#00bc00'
    window.after_cancel(after_id)

def start():
    global after_id, timer_btn_color
    try:
        time = int(minutes_var.get() * 60 * 1000)
    except:
        messagebox.showerror(title = APP_TITLE, message = 'Invalid time')
    else:
        timer_btn.config(bg = '#ff1629', text='Stop Timer', command=stop)
        timer_btn_color = '#ff1629'
        after_id = window.after(time, rest_message)

window = tk.Tk()
window.title(APP_TITLE)

# --- Application icon ---

icon = tk.PhotoImage(data=ICON_BYTES)
window.iconphoto(True, icon)

# --- Application Main Frame ---

frm = tk.Frame(bd=5)
frm.pack()

minutes_lbl = tk.Label(frm,text = 'Time in minutes:')
minutes_var = tk.DoubleVar(value = 20)

# --- Start/Stop Timer button

is_number_register = window.register(lambda text : True if re.fullmatch(r'[\d\.]*', text) and text.count('.') < 2 else False)
minutes_entry = ttk.Spinbox(frm,textvariable = minutes_var, validate='key', validatecommand=(is_number_register, '%P'), from_=0,to=float('inf'))
timer_btn = tk.Button(frm,text='Start Timer', bg = '#00bc00', command=start, cursor='hand2')

minutes_lbl.grid(row = 0, column = 0)
minutes_entry.grid(row=0,column=1,padx=5)
timer_btn.grid(row=0,column=2)

timer_btn.bind('<Enter>', lambda event : timer_btn.config(bg='#9fbc00' if timer_btn_color == '#00bc00' else '#ff8629'))
timer_btn.bind('<Leave>', lambda event : timer_btn.config(bg='#00bc00' if timer_btn_color == '#00bc00' else '#ff3629'))

# --- This launchs the program ---

window.mainloop()
